@namespace iPath.Blazor.Componenents.Shared

@if (appState.IsAuthenticated)
{
    <MudMenu ActivationEvent="MouseEvent.LeftClick">
        <ActivatorContent>
            <MudBadge Color="@appState.PresenceColor" Overlap="true" Bordered="true">
                <MudAvatar>@appState.User.Initials</MudAvatar>
            </MudBadge>
        </ActivatorContent>
        <ChildContent>
            <MudMenuItem Label=@T["Profile"] Icon="@Icons.Material.Filled.ManageAccounts" Href="/user/profile" />
            <MudMenuItem Label=@T["Notification Settings"] Icon="@Icons.Material.Filled.Settings" OnClick="vm.ShowUserNotifications" />
            <MudMenuItem Label=@T["My Cases"] Icon="@Icons.Material.Filled.Folder" Href="/user/cases" />
            <MudMenuItem Label=@T["My Groups"] Icon="@Icons.Material.Filled.Group" Href="/user/groups" />
            <!--
            <MudMenu Label=@T["Community"] StartIcon="@Icons.Material.Filled.Groups">
                @if (user is not null)
                {
                    foreach (var c in user.CommunityMembership)
                    {
                        <MudMenuItem Label=@c.Communityname Icon="@Icons.Material.Filled.Group" Href=@($"community/{c.CommunityId}") />
                    }
                }
            </MudMenu>
            -->
        </ChildContent>
    </MudMenu>
}
else
{
    <MudAvatar />
}

@inject AppState appState
@inject UserViewModel vm
@inject IStringLocalizer T

@code {
    UserDto user;

    protected override async Task OnInitializedAsync()
    {
        await LoadUser();
    }

    async Task LoadUser()
    {
        if (appState is not null)
        {
            await appState.ReloadSession();
            user = await vm.GetUserAsync(appState.User.Id);
            StateHasChanged();
        }
    }
}
