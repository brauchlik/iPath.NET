@namespace iPath.Blazor.Componenents.Users

@inject IPathApi api
@inject ISnackbar snackbar


<MudStack Row Spacing="2" AlignItems="AlignItems.Center">
    <ProgressButton OnClick="ToggleUploadFolder" Text="@ButtonText" Icon="@ButtonIcon" 
        Color="@ButtonColor" Disabled="@ButtonDisaabled" Class="@Class"/>
</MudStack>

@code {
    [Parameter]
    public UserDto? User { get; set; }

    [Parameter]
    public string Class { get; set; } = "";


    string ButtonText => HasUploadFolder ? "Delete Google folder" : "Create Google folder";
    string ButtonIcon => HasUploadFolder ? Icons.Material.Filled.FolderDelete : Icons.Material.Filled.FolderShared;
    Color ButtonColor => HasUploadFolder ? Color.Primary : Color.Surface;
    bool ButtonDisaabled => !User.HasGoogleAccount;

    bool HasUploadFolder { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        if (User is not null)
        {
            HasUploadFolder = User.UploadFolderId.HasValue;
        }
    }



    async Task ToggleUploadFolder()
    {
        if (User is not null)
        {
            var res = await (HasUploadFolder ? api.DeleteUploadFolder(User.Id) : api.CreateUploadFolder(User.Id));
            if (snackbar.CheckSuccess(res))
            {
                HasUploadFolder = !HasUploadFolder;
                StateHasChanged();
            }
        }
    }
}
